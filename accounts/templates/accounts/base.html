<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Books â€” Simple Frontend</title>
    <style>
      body{font-family:Segoe UI, Roboto, Arial, sans-serif;background:#f5f7fb;color:#222;margin:0}
      header{background:#0b5cff;color:#fff;padding:12px}
      nav a{color:#fff;text-decoration:none;margin-right:12px}
      .container{max-width:720px;margin:28px auto;padding:18px;background:#fff;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.08)}
      label{display:block;margin:8px 0}
      input[type=text], input[type=password]{padding:8px;width:100%;box-sizing:border-box}
      button{background:#0b5cff;color:#fff;border:none;padding:8px 12px;border-radius:4px;cursor:pointer}
      #userInfo{float:right;font-size:0.95em}
      .muted{color:#666;font-size:0.9em}
    </style>
  </head>
  <body>
    <header>
      <nav>
  <a href="/accounts/pages/public/">Public</a>
  <a href="/accounts/pages/register/">Register</a>
  <a id="loginLink" href="/accounts/pages/login/">Login</a>
        <a id="logoutLink" href="#" style="display:none">Logout</a>
  <a href="/accounts/pages/protected/">Protected</a>
        <span id="userInfo"></span>
      </nav>
    </header>
    <main class="container">
      {% block content %}{% endblock %}
    </main>

    <script>
  (function(){
        const access = localStorage.getItem('access');
        const userInfo = document.getElementById('userInfo');
        const loginLink = document.getElementById('loginLink');
        const logoutLink = document.getElementById('logoutLink');
        if(access){
          loginLink.style.display = 'none';
          logoutLink.style.display = 'inline';
          try{
            if(typeof access === 'string' && (access.match(/\./g) || []).length >= 2){
              const part = access.split('.')[1] || '';
              const decoded = atob(part.replace(/-/g,'+').replace(/_/g,'/'));
              const payload = JSON.parse(decoded);
              if(payload && payload.username) userInfo.innerText = 'Hello, ' + payload.username;
            }
          }catch(e){ console.warn('Failed to decode access token for UI', e); }
        } else {
          loginLink.style.display = 'inline';
          logoutLink.style.display = 'none';
          userInfo.innerText = '';
        }
        logoutLink.addEventListener('click', ()=>{
          const refresh = localStorage.getItem('refresh');
          const access = localStorage.getItem('access');
          if(!refresh){ localStorage.removeItem('access'); localStorage.removeItem('refresh'); window.location.href='/accounts/pages/public/'; return; }
          fetch('/api/accounts/logout/', {method:'POST', headers:{'Content-Type':'application/json','Authorization':'Bearer '+access}, body: JSON.stringify({refresh})}).finally(()=>{
            localStorage.removeItem('access'); localStorage.removeItem('refresh'); document.cookie = 'access=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;'; window.location.href='/accounts/pages/public/';
          });
        });
      })();
    </script>
  </body>
</html>